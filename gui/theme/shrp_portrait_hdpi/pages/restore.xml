<?xml version="1.0"?>
<recovery>
	<pages>
		<page name="restore">
			<template name="c_page"/>
			<template name="c_status_bar"/>
			<template name="c_simple_sort"/>
			<text style="c_main_text_header">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_first_header%"/>
				<text>{@restore_hdr=Restore}</text>
			</text>
			<text style="c_text_dashboard">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_second_header%"/>
				<text>{@restore_sel_store_hdr=Select Backup from %tw_storage_display_name% (%tw_storage_free_size% MB)}</text>
			</text>
			<fileselector style="c_restore">
				<placement x="%c_hawk_base_column%" y="%file_selector_default_y%" w="%file_selector_default_w%" h="%file_selector_default_h%"/>
				<filter folders="1" files="1" nav="0" extn=".ab"/>
				<path name="tw_backups_folder"/>
				<data name="tw_restore" default=""/>
				<sort name="tw_gui_sort_order"/>
				<selection name="tw_restore_name"/>
			</fileselector>
			<button>
				<placement x="860" y="1628"/>
				<image resource="c_storage"/>
				<actions>
					<action function="set">tw_back=restore</action>
					<action function="overlay">select_storage</action>
				</actions>
			</button>

			<action>
				<condition var1="tw_restore" op="modified"/>
				<actions>
					<action function="readBackup"/>
					<action function="page">restore_read</action>
				</actions>
			</action>
			<action>
				<touch key="home"/>
				<action function="page">c_refresh</action>
			</action>

			<action>
				<touch key="back"/>
				<action function="page">c_refresh</action>
			</action>
		</page>

		<page name="restore_read">
			<action>
				<condition var1="tw_restore_encrypted" var2="1"/>
				<actions>
					<action function="set">tw_password_fail=0</action>
					<action function="page">restore_decrypt</action>
				</actions>
			</action>

			<action>
				<condition var1="tw_restore_encrypted" var2="0"/>
				<actions>
					<action function="page">restore_select</action>
				</actions>
			</action>
		</page>

		<page name="restore_decrypt">
			<template name="c_page"/>
			<template name="c_status_bar"/>
			<text style="c_main_text_header">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_first_header%"/>
				<text>{@restore_hdr=Restore}</text>
			</text>
			<text style="c_text_dashboard">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_second_header%"/>
				<text>{@restore_enc_backup_hdr=Encrypted Backup}</text>
			</text>

			<text style="c_sub">
				<placement x="%c_hawk_base_column%" y="%c_text_sub_y2%"/>
				<text>{@enter_pass=Enter Password:}</text>
			</text>
			<input>
				<placement x="%indent%" y="%restore_ecry_y%" w="%content_width%" h="%input_height%"/>
				<text>%tw_restore_display%</text>
				<data name="tw_restore_password" mask="*" maskvariable="tw_restore_display"/>
				<restrict minlen="1" maxlen="32" allow="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_"/>
				<action function="page">try_restore_decrypt</action>
			</input>

			<text style="c_sub">
				<condition var1="tw_password_fail" var2="1"/>
				<placement x="%c_hawk_base_column%" y="%c_text_sub_y%"/>
				<text>{@restore_dec_fail=Password failed, please try again!}</text>
			</text>

			<button>
				<placement x="860" y="1450"/>
				<image resource="c_delete"/>
				<actions>
					<action function="set">tw_back=restore</action>
					<action function="set">tw_action=cmd</action>
					<action function="set">tw_action_param=cd %tw_backups_folder% &amp;&amp; rm -rf "%tw_restore_name%"</action>
					<action function="set">tw_text1={@del_backup_confirm=Delete Backup?}</action>
					<action function="set">tw_text2=%tw_restore_name%</action>
					<action function="set">tw_text4={@del_backup_confirm2=This cannot be undone!}</action>
					<action function="set">tw_action_text1={@deleting_backup=Deleting Backup...}</action>
					<action function="set">tw_complete_text1={@backup_deleted=Backup Delete Complete}</action>
					<action function="set">tw_slider_text={@swipe_delete=Swipe to Delete}</action>
					<action function="page">confirm_action</action>
				</actions>
			</button>

			<template name="keyboardtemplate"/>


			<action>
				<touch key="home"/>
				<action function="page">c_refresh</action>
			</action>

			<action>
				<touch key="back"/>
				<actions>
					<action function="set">tw_page_done=1</action>
					<action function="page">restore</action>
				</actions>
			</action>
		</page>

		<page name="try_restore_decrypt">
			<template name="c_page"/>
			<template name="c_status_bar"/>
			<text style="c_main_text_header">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_first_header%"/>
				<text>{@restore_hdr=Restore}</text>
			</text>
			<text style="c_text_dashboard">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_second_header%"/>
				<text>{@restore_try_decrypt_s=Trying Decryption}</text>
			</text>
			<template name="c_console"/>
			<template name="progress_bar"/>

			<action>
				<action function="decrypt_backup"/>
			</action>
			<action>
				<conditions>
					<condition var1="tw_operation_state" var2="1"/>
					<condition var1="tw_operation_status" op="!=" var2="0"/>
				</conditions>
				<actions>
					<action function="set">tw_password_fail=1</action>
					<action function="page">restore_decrypt</action>
				</actions>
			</action>
			<action>
				<conditions>
					<condition var1="tw_operation_state" var2="1"/>
					<condition var1="tw_operation_status" op="=" var2="0"/>
				</conditions>
				<actions>
					<action function="set">tw_page_done=1</action>
					<action function="page">restore_select</action>
				</actions>
			</action>
		</page>

		<page name="restore_select">
			<template name="c_page"/>
			<template name="c_status_bar"/>
			<text style="c_main_text_header">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_first_header%"/>
				<text>{@restore_hdr=Restore}</text>
			</text>
			<text style="c_text_dashboard">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_second_header%"/>
				<text>{@restore_backup_date=Backup made on %tw_restore_file_date%}</text>
			</text>
			<text style="c_sub">
				<placement x="%c_hawk_base_column%" y="%c_text_sub_y_spec%"/>
				<text>{@c_name=Name:}</text>
			</text>

			<text style="c_sub">
				<placement x="%c_hawk_base_column%" y="%c_text_sub_y3%"/>
				<text>%tw_restore_name%</text>
			</text>

			<button>
				<placement x="%c_hawk_base_column%" y="%c_text_sub_y3%" w="%file_selector_default_w%" h="%navbar_height%"/>
				<fill color="%transparent%"/>
				<actions>
					<action function="set">tw_backup_rename=%tw_restore_name%</action>
					<action function="set">tw_fileexists=0</action>
					<action function="page">renamebackup</action>
				</actions>
			</button>

			<partitionlist>
				<placement x="50" y="%t_1st_radio_text_pos%" w="%file_selector_default_w%" h="%t_4th_radio_text_pos%"/>
				<data name="tw_restore_list" selectedlist="tw_restore_selected"/>
				<listtype name="restore"/>
			</partitionlist>

			<checkbox>
				<condition var1="tw_enable_adb_backup" op="=" var2="0"/>
				<placement x="%c_hawk_base_column%" y="1650"/>
				<text>{@restore_enable_digest_chk=Digest Verification}</text>
				<data variable="tw_skip_digest_check"/>
			</checkbox>

			<button>
				<placement x="860" y="1450"/>
				<image resource="c_delete"/>
				<actions>
					<action function="set">tw_back=restore</action>
					<action function="set">tw_action=cmd</action>
					<action function="set">tw_action_param=cd %tw_backups_folder% &amp;&amp; rm -rf "%tw_restore_name%"</action>
					<action function="set">tw_text1={@del_backup_confirm=Delete Backup?}</action>
					<action function="set">tw_text2=%tw_restore_name%</action>
					<action function="set">tw_text4={@del_backup_confirm2=This cannot be undone!}</action>
					<action function="set">tw_action_text1={@deleting_backup=Deleting Backup...}</action>
					<action function="set">tw_complete_text1={@backup_deleted=Backup Delete Complete}</action>
					<action function="set">tw_slider_text={@swipe_delete=Swipe to Delete}</action>
					<action function="page">confirm_action</action>
				</actions>
			</button>

			<button>
				<placement x="860" y="1628"/>
				<image resource="c_ok"/>
				<action function="page">restore_run</action>
			</button>


			<action>
				<touch key="home"/>
				<action function="page">c_refresh</action>
			</action>

			<action>
				<touch key="back"/>
				<action function="page">restore</action>
			</action>
		</page>

		<page name="renamebackup">
			<template name="c_page"/>
			<template name="c_status_bar"/>
			<text style="c_main_text_header">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_first_header%"/>
				<text>{@restore_hdr=Restore}</text>
			</text>
			<text style="c_text_dashboard">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_second_header%"/>
				<text>{@rename_backup_hdr=Rename Backup}</text>
			</text>
			<text style="c_sub">
				<placement x="%c_hawk_base_column%" y="%c_text_sub_y_spec%"/>
				<text>{@c_name=Name:}</text>
			</text>

			<fill color="nav_bg">
				<placement x="50" y="%dash_ico_1st_row%" w="970" h="94"/>
			</fill>

			<input>
				<placement x="80" y="%input_file_manager_y%" w="800" h="64"/>
				<background color="%nav_bg%"/>
				<text>%tw_backup_rename%</text>
				<data name="tw_backup_rename"/>
				<restrict minlen="1" maxlen="64" allow=" abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-_.{}[]"/>
				<actions>
					<action function="set">tw_back=restore</action>
					<action function="set">tw_action=cmd</action>
					<action function="set">tw_action_param=cd %tw_backups_folder% &amp;&amp; mv "%tw_restore_name%" "%tw_backup_rename%"</action>
					<action function="set">tw_text1={@rename_backup_confirm=Rename Backup?}</action>
					<action function="set">tw_text2={@rename_backup_confirm2=This cannot be undone!}</action>
					<action function="set">tw_action_text1={@renaming_backup=Renaming Backup...}</action>
					<action function="set">tw_complete_text1={@rename_backup_complete=Backup Rename Complete}</action>
					<action function="set">tw_slider_text={@swipe_to_rename=Swipe to Rename}</action>
					<action function="set">tw_filecheck=%tw_backups_folder%/%tw_backup_rename%</action>
					<action function="set">tw_existpage=renamebackup</action>
					<action function="set">tw_notexistpage=confirm_action</action>
					<action function="page">filecheck</action>
				</actions>
			</input>
			<text style="c_sub">
				<condition var1="tw_fileexists" var2="1"/>
				<placement x="%c_hawk_base_column%" y="%c_text_sub_y3%"/>
				<text>{@backup_name_exists=A backup with that name already exists!}</text>
			</text>
			<template name="keyboardtemplate"/>

			<action>
				<touch key="home"/>
				<action function="page">c_refresh</action>
			</action>

			<action>
				<touch key="back"/>
				<action function="page">restore_select</action>
			</action>
		</page>

		<page name="restore_run">
			<template name="c_page"/>
			<template name="c_status_bar"/>
			<text style="c_main_text_header">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_first_header%"/>
				<text>{@restore_hdr=Restore}</text>
			</text>
			<text style="c_text_dashboard">
				<placement x="%c_hawk_base_column%" y="%c_hawk_base_second_header%"/>
				<text>%tw_operation% %tw_partition%</text>
			</text>
			<template name="c_console_custom"/>
			<template name="progress_bar"/>
			<text style="c_sub">
				<placement x="%c_hawk_base_column%" y="1430"/>
				<text>{@progress=Progress:} %tw_size_progress%</text>
			</text>

			<action>
				<condition var1="tw_operation_state" var2="1"/>
				<actions>
					<action function="set">tw_back=restore_select</action>
					<action function="set">tw_complete_text1={@restore_complete=Restore Complete}</action>
					<action function="set">tw_show_reboot=1</action>
					<action function="page">action_complete</action>
				</actions>
			</action>

			<action>
				<action function="nandroid">restore</action>
			</action>
		</page>
	</pages>
</recovery>